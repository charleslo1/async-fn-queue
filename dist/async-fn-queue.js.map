{"version":3,"file":"async-fn-queue.js","sources":["../src/Queue.js","../src/QueueManager.js","../src/main.js"],"sourcesContent":["/**\n * Queue 类\n */\nclass Queue {\n  constructor (name) {\n    this.name = 'default'   // 队列名称\n    this.isExec = false     // 是否可执行队列\n    this.runing = false     // 是否正在执行队列\n    this.asyncFns = []      // 待执行函数列表\n  }\n\n  /**\n   * 添加异步操作函数\n   * @param {Function} fn 异步操作函数\n   * @return {Object}      this\n   */\n  add (fn) {\n    this.asyncFns.push(fn)\n    return this\n  }\n\n  /**\n   * 按顺序执行异步操作队列\n   * @return {Object}      this\n   */\n  start () {\n    // 标记执行\n    this.asyncFns.forEach((fn) => {\n      fn.__exec = true\n    })\n    // 开始按顺序执行操作\n    this.isExec = true\n    this.__nextTick()\n    return this\n  }\n\n  /**\n   * 递归执行异步操作队列\n   */\n  __nextTick () {\n    if (!this.isExec || this.runing) return\n    if (this.asyncFns.length === 0) return this.pause()\n\n    let fn = this.asyncFns.shift()\n    if (!fn.__exec) {\n      this.asyncFns.unshift(fn)\n      return this.pause()\n    }\n\n    this.runing = true\n    if (fn instanceof Function) {\n      let promise = fn()\n      let runNext = () => {\n        this.runing = false\n        this.__nextTick()\n      }\n      if (promise instanceof Promise) {\n        promise.then(runNext).catch(runNext)\n      } else {\n        runNext()\n      }\n    }\n  }\n\n  /**\n   * 停止执行\n   * @return {Object}      this\n   */\n  pause () {\n    this.isExec = false\n    this.runing = false\n    return this\n  }\n\n  /**\n   * 清除所有异步操作\n   * @return {Object}      this\n   */\n  stop () {\n    this.pause()\n    this.asyncFns = []\n    return this\n  }\n\n  /**\n   * 执行下一个异步操作\n   * @param  {Function} fn 异步操作函数\n   * @return {Object}      this\n   */\n  next (fn) {\n    return this.add(fn).start()\n  }\n}\n\nexport default Queue\n","import Queue from './Queue'\n\n/**\n * QueueManager\n */\nclass QueueManager {\n  constructor () {\n    // 队列列表\n    this.queues = {}\n  }\n\n  /**\n   * 根据名称获取队列，不存在则创建\n   * @param  {String} name 队列名称\n   * @return {Queue}       队列对象\n   */\n  get (name) {\n    let queue = this.queues[name]\n    if (!queue) {\n      queue = new Queue(name)\n      this.queues[name] = queue\n    }\n    return queue\n  }\n}\n\nexport default QueueManager\n","import QueueManager from './QueueManager'\n\n// 实例化 queueManager\nconst queueManager = new QueueManager()\n\nexport default queueManager\n"],"names":["Queue","name","isExec","runing","asyncFns","fn","push","forEach","__exec","__nextTick","length","pause","shift","unshift","Function","promise","runNext","then","catch","add","start","QueueManager","queues","queue","queueManager"],"mappings":";;;;;;;;;;AAAA;;;IAGMA;iBACSC,IAAb,EAAmB;;;SACZA,IAAL,GAAY,SAAZ,CADiB;SAEZC,MAAL,GAAc,KAAd,CAFiB;SAGZC,MAAL,GAAc,KAAd,CAHiB;SAIZC,QAAL,GAAgB,EAAhB,CAJiB;;;;;;;;;;;;wBAYdC,IAAI;WACFD,QAAL,CAAcE,IAAd,CAAmBD,EAAnB;aACO,IAAP;;;;;;;;;;4BAOO;;WAEFD,QAAL,CAAcG,OAAd,CAAsB,UAACF,EAAD,EAAQ;WACzBG,MAAH,GAAY,IAAZ;OADF;;WAIKN,MAAL,GAAc,IAAd;WACKO,UAAL;aACO,IAAP;;;;;;;;;iCAMY;;;UACR,CAAC,KAAKP,MAAN,IAAgB,KAAKC,MAAzB,EAAiC;UAC7B,KAAKC,QAAL,CAAcM,MAAd,KAAyB,CAA7B,EAAgC,OAAO,KAAKC,KAAL,EAAP;;UAE5BN,KAAK,KAAKD,QAAL,CAAcQ,KAAd,EAAT;UACI,CAACP,GAAGG,MAAR,EAAgB;aACTJ,QAAL,CAAcS,OAAd,CAAsBR,EAAtB;eACO,KAAKM,KAAL,EAAP;;;WAGGR,MAAL,GAAc,IAAd;UACIE,cAAcS,QAAlB,EAA4B;YACtBC,UAAUV,IAAd;YACIW,UAAU,SAAVA,OAAU,GAAM;gBACbb,MAAL,GAAc,KAAd;gBACKM,UAAL;SAFF;YAIIM,2BAAJ,EAAgC;kBACtBE,IAAR,CAAaD,OAAb,EAAsBE,KAAtB,CAA4BF,OAA5B;SADF,MAEO;;;;;;;;;;;;;4BAUF;WACFd,MAAL,GAAc,KAAd;WACKC,MAAL,GAAc,KAAd;aACO,IAAP;;;;;;;;;;2BAOM;WACDQ,KAAL;WACKP,QAAL,GAAgB,EAAhB;aACO,IAAP;;;;;;;;;;;yBAQIC,IAAI;aACD,KAAKc,GAAL,CAASd,EAAT,EAAae,KAAb,EAAP;;;;;;;ACxFJ;;;;IAGMC;0BACW;;;;SAERC,MAAL,GAAc,EAAd;;;;;;;;;;;;wBAQGrB,MAAM;UACLsB,QAAQ,KAAKD,MAAL,CAAYrB,IAAZ,CAAZ;UACI,CAACsB,KAAL,EAAY;gBACF,IAAIvB,KAAJ,CAAUC,IAAV,CAAR;aACKqB,MAAL,CAAYrB,IAAZ,IAAoBsB,KAApB;;aAEKA,KAAP;;;;;;;ACpBJ;AACA,IAAMC,iBAAe,IAAIH,YAAJ,EAArB;;;;;;;;"}