{"version":3,"file":"async-fn-queue.js","sources":["../src/Queue.js","../src/QueueManager.js","../src/main.js"],"sourcesContent":["/**\n * Queue 类\n */\nclass Queue {\n  constructor (name) {\n    this.name = 'default'   // 队列名称\n    this.canExec = false     // 是否可执行队列\n    this.runing = false     // 是否正在执行队列\n    this.asyncFns = []      // 待执行函数列表\n  }\n\n  /**\n   * 添加异步操作函数\n   * @param {Function} fn 异步操作函数\n   * @return {Object}      this\n   */\n  push (fn) {\n    if (fn instanceof Function) {\n      this.asyncFns.push(fn)\n    } else {\n      throw new Error('队列只接受 Function 类型')\n    }\n    return this\n  }\n\n  /**\n   * 获取最前面的异步操作函数\n   * @return {Function}   异步操作函数\n   */\n  pop () {\n    return this.asyncFns.shift()\n  }\n\n  /**\n   * 按顺序执行异步操作队列\n   * @return {Object}      this\n   */\n  start () {\n    // 标记执行\n    this.asyncFns.forEach((fn) => {\n      fn.__exec = true\n    })\n    // 开始按顺序执行操作\n    this.canExec = true\n    this.__nextTick()\n    return this\n  }\n\n  /**\n   * 递归执行异步操作队列\n   */\n  __nextTick () {\n    if (!this.canExec || this.runing) return\n    if (this.asyncFns.length === 0) return this.pause()\n\n    let fn = this.asyncFns.shift()\n    if (!fn.__exec) {\n      this.asyncFns.unshift(fn)\n      return this.pause()\n    }\n\n    this.runing = true\n    let promise = fn()\n    let runNext = () => {\n      this.runing = false\n      this.__nextTick()\n    }\n    if (promise instanceof Promise) {\n      promise.then(runNext).catch(runNext)\n    } else {\n      runNext()\n    }\n  }\n\n  /**\n   * 停止执行\n   * @return {Object}      this\n   */\n  pause () {\n    this.canExec = false\n    this.runing = false\n    return this\n  }\n\n  /**\n   * 清除所有异步操作\n   * @return {Object}      this\n   */\n  stop () {\n    this.pause()\n    this.asyncFns = []\n    return this\n  }\n\n  /**\n   * 执行下一个异步操作\n   * @param  {Function} fn 异步操作函数\n   * @return {Object}      this\n   */\n  next (fn) {\n    return this.push(fn).start()\n  }\n}\n\nexport default Queue\n","import Queue from './Queue'\n\n/**\n * QueueManager 类\n */\nclass QueueManager {\n  constructor () {\n    // 队列列表\n    this.queues = {}\n  }\n\n  /**\n   * 根据名称获取队列，不存在则创建\n   * @param  {String} name 队列名称\n   * @return {Queue}       队列对象\n   */\n  get (name) {\n    let queue = this.queues[name]\n    if (!queue) {\n      queue = new Queue(name)\n      this.queues[name] = queue\n    }\n    return queue\n  }\n}\n\nexport default QueueManager\n","import QueueManager from './QueueManager'\n\n// 实例化 queueManager\nconst queueManager = new QueueManager()\n\nexport default queueManager\n"],"names":["Queue","name","canExec","runing","asyncFns","fn","Function","push","Error","shift","forEach","__exec","__nextTick","length","pause","unshift","promise","runNext","then","catch","start","QueueManager","queues","queue","queueManager"],"mappings":";;;;;;;;;;AAAA;;;IAGMA;iBACSC,IAAb,EAAmB;;;SACZA,IAAL,GAAY,SAAZ,CADiB;SAEZC,OAAL,GAAe,KAAf,CAFiB;SAGZC,MAAL,GAAc,KAAd,CAHiB;SAIZC,QAAL,GAAgB,EAAhB,CAJiB;;;;;;;;;;;;yBAYbC,IAAI;UACJA,cAAcC,QAAlB,EAA4B;aACrBF,QAAL,CAAcG,IAAd,CAAmBF,EAAnB;OADF,MAEO;cACC,IAAIG,KAAJ,CAAU,mBAAV,CAAN;;aAEK,IAAP;;;;;;;;;;0BAOK;aACE,KAAKJ,QAAL,CAAcK,KAAd,EAAP;;;;;;;;;;4BAOO;;WAEFL,QAAL,CAAcM,OAAd,CAAsB,UAACL,EAAD,EAAQ;WACzBM,MAAH,GAAY,IAAZ;OADF;;WAIKT,OAAL,GAAe,IAAf;WACKU,UAAL;aACO,IAAP;;;;;;;;;iCAMY;;;UACR,CAAC,KAAKV,OAAN,IAAiB,KAAKC,MAA1B,EAAkC;UAC9B,KAAKC,QAAL,CAAcS,MAAd,KAAyB,CAA7B,EAAgC,OAAO,KAAKC,KAAL,EAAP;;UAE5BT,KAAK,KAAKD,QAAL,CAAcK,KAAd,EAAT;UACI,CAACJ,GAAGM,MAAR,EAAgB;aACTP,QAAL,CAAcW,OAAd,CAAsBV,EAAtB;eACO,KAAKS,KAAL,EAAP;;;WAGGX,MAAL,GAAc,IAAd;UACIa,UAAUX,IAAd;UACIY,UAAU,SAAVA,OAAU,GAAM;cACbd,MAAL,GAAc,KAAd;cACKS,UAAL;OAFF;UAIII,2BAAJ,EAAgC;gBACtBE,IAAR,CAAaD,OAAb,EAAsBE,KAAtB,CAA4BF,OAA5B;OADF,MAEO;;;;;;;;;;;;4BASA;WACFf,OAAL,GAAe,KAAf;WACKC,MAAL,GAAc,KAAd;aACO,IAAP;;;;;;;;;;2BAOM;WACDW,KAAL;WACKV,QAAL,GAAgB,EAAhB;aACO,IAAP;;;;;;;;;;;yBAQIC,IAAI;aACD,KAAKE,IAAL,CAAUF,EAAV,EAAce,KAAd,EAAP;;;;;;;AClGJ;;;;IAGMC;0BACW;;;;SAERC,MAAL,GAAc,EAAd;;;;;;;;;;;;wBAQGrB,MAAM;UACLsB,QAAQ,KAAKD,MAAL,CAAYrB,IAAZ,CAAZ;UACI,CAACsB,KAAL,EAAY;gBACF,IAAIvB,KAAJ,CAAUC,IAAV,CAAR;aACKqB,MAAL,CAAYrB,IAAZ,IAAoBsB,KAApB;;aAEKA,KAAP;;;;;;;ACpBJ;AACA,IAAMC,iBAAe,IAAIH,YAAJ,EAArB;;;;;;;;"}